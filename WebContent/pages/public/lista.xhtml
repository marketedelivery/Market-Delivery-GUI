<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:body>
	<ui:composition template="/pages/templates/modeloGeral.xhtml">
		<ui:define name="conteudo">
			<h:form id="form">

				<script type="text/javascript">
					function handleDrop(event, ui) {
						var droppedProduto = ui.draggable;

						droppedProduto.fadeOut('fast');
					}
				</script>
				<h:panelGrid columns="2">
				</h:panelGrid>
				<p:growl id="msgGlobal" sticky="true" />
				<h:form id="listaForm">
					<p:fieldset id="pdtSupermercado" legend="Produto dos Supermercados">
						<h:panelGrid columns="2">
							<p:outputLabel value ="Nome da lista"/>
							<p:inputText values="#{itemMB.item.lista.nome}"  size="20" maxlength="20"
							placeholder="Nome da lista"
							required="true" requiredMessage="Olá usuário, atribua um nome para sua lista" />
						</h:panelGrid>
						
						<h:panelGrid columns="2">
							<p:selectOneMenu value="#{itemMB.produto.supermercado}"
								converter="supermercadoConverter">
								<f:selectItem noSelectionOption="true"
									itemLabel="Selecione um supermercado" itemValue="-1" />
								<f:selectItems value="#{itemMB.listaTodoSupermercado}"
									var="supermercado" itemValue="#{supermercado}"
									itemLabel="#{supermercdo.nome}" />
							</p:selectOneMenu>
							<p:commandButton update="tabela" value="Buscar" ajax="false"
								actionListener="#{itemMB.listar}" />
						</h:panelGrid>

						<p:dataTable id="listaProdutoSupermercado"
							emptyMessage="Nenhum registro encontrado...."
							value="#{itemMB.todosProdutos}"
							filteredValue="#{itemMB.produtosFiltrados}" var="it"
							rows="6" paginator="true">

							<p:column style="width:20px">
								<h:outputText id="dragIcon" styleClass="ui-icon ui-icon-arrow-4" />
								<p:draggable for="dragIcon" revert="true" helper="clone" />
							</p:column>

							<p:column headerText="Código">
								<h:outputText value="#{it.produto.codigo}" />
							</p:column>

							<p:column headerText="Nome" filterBy="#{it.produto.nome}"
								sortBy="#{it.produto.nome}">
								<h:outputText value="#{it.produto.nome}" />
							</p:column>

							<p:column headerText="Marca" filterBy="#{it.produto.marca}"
								sortBy="#{it.produto.marca}">
								<h:outputText value="#{it.produto.marca}" />
							</p:column>

							<p:column headerText="Valor Unitario">
								<h:outputText value="#{it.produto.valorUnitario}" />
							</p:column>
							
							<p:column headerText="Ação">
									<p:commandButton var = "item" value=" Adicionar" 
									actionListener="#{itemMB.adicionar(it)}"
									update=":form:listaForm:pdtSelecionado"/>
								</p:column>
						</p:dataTable>
					</p:fieldset>

					<p:fieldset id="pdtSelecionado" legend="Produtos Selecionados" >
						<p:outputPanel id="dropArea">
							<h:outputText value="Arraste o produto desejado e coloque aqui"
								rendered="#{empty itemMB.listaProduto}" />

							<p:dataTable id="produtosSelecionados" var="item"
								value="#{itemMB.listaItens}"
								rendered="#{not empty itemMB.listaItens}">

								<p:column headerText="Código">
									<h:outputText value="#{item.produto.codigo}" />
								</p:column>

								<p:column headerText="Nome" filterBy="#{item.produto.nome}"
									sortBy="#{item.produto.nome}">
									<h:outputText value="#{item.produto.nome}" />
								</p:column>

								<p:column headerText="Marca" filterBy="#{item.produto.marca}"
									sortBy="#{item.produto.marca}">
									<h:outputText value="#{item.produto.marca}" />
								</p:column>

								<p:column headerText="Quantidade">
									<p:spinner id="minMax" value="#{item.qtdProduto}" min="0"
										max="100" >
										<p:ajax update="valorTotal" process="@this"/>
									</p:spinner>
								</p:column>

								<p:column headerText="Valor Unitario">
									<h:outputText value="#{item.produto.valorUnitario}" />
								</p:column>

								<p:column headerText="Valor Total">
									<h:outputText id="valorTotal"
										value="#{item.produto.valorUnitario*item.qtdProduto}" />
								
								</p:column>
								
								<p:column headerText="Ação">
									<p:commandButton var = "item" value="remover" 
									actionListener="#{itemMB.remover(item)}"
									update=":form:listaForm:pdtSelecionado"/>
								</p:column>
								<f:facet name="footer">
									<p:commandButton value="Cadastrar Lista"
										action="#{itemMB.cadastrarLista}" />
								</f:facet>
							</p:dataTable>
						</p:outputPanel>
					</p:fieldset>

					<p:droppable for="pdtSelecionado" tolerance="touch"
						activeStyleClass="ui-state-highlight"
						datasource="listaProdutoSupermercado" onDrop="handleDrop">
						<p:ajax listener="#{itemMB.produtoOnDrop}"
							update="dropArea listaProdutoSupermercado" render="produtosSelecionados"/>
					</p:droppable>

				</h:form>

			</h:form>
		</ui:define>
	</ui:composition>
</h:body>
</html>